\doxysection{C\+:/\+Users/\+Igor/\+STM32\+Cube\+IDE/workspace\+\_\+1.16.1/\+PID\+\_\+regulator\+\_\+project/\+Core/\+Src/main.c File Reference}
\hypertarget{main_8c}{}\label{main_8c}\index{C:/Users/Igor/STM32CubeIDE/workspace\_1.16.1/PID\_regulator\_project/Core/Src/main.c@{C:/Users/Igor/STM32CubeIDE/workspace\_1.16.1/PID\_regulator\_project/Core/Src/main.c}}


Plik nagłówkowy do sterowania silnikiem DC z wykorzystaniem algorytmu PID.  


{\ttfamily \#include "{}main.\+h"{}}\newline
{\ttfamily \#include "{}cytron\+Driver.\+h"{}}\newline
{\ttfamily \#include "{}motor.\+h"{}}\newline
{\ttfamily \#include "{}string.\+h"{}}\newline
{\ttfamily \#include "{}stdio.\+h"{}}\newline
{\ttfamily \#include "{}./\+I2\+C\+\_\+\+LCD\+\_\+\+Inc/\+I2\+C\+\_\+\+LCD.\+h"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_a70af21c671abfcc773614a9a4f63d920}{System\+Clock\+\_\+\+Config}} (void)
\begin{DoxyCompactList}\small\item\em System Clock Configuration. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\begin{DoxyCompactList}\small\item\em Główna funkcja programu, zawiera inicjalizację peryferiów oraz obsługę wystawionych flag. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a8a3b0ad512a6e6c6157440b68d395eac}{HAL\+\_\+\+TIM\+\_\+\+Period\+Elapsed\+Callback}} (TIM\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*}htim)
\begin{DoxyCompactList}\small\item\em Callback do obsługi przerwania timera. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a0cd91fd3a9608559c2a87a8ba6cba55f}{HAL\+\_\+\+GPIO\+\_\+\+EXTI\+\_\+\+Callback}} (uint16\+\_\+t GPIO\+\_\+\+Pin)
\begin{DoxyCompactList}\small\item\em Callback do obsługi przerwania zewnętrznego (przycisk). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a1730ffe1e560465665eb47d9264826f9}{Error\+\_\+\+Handler}} (void)
\begin{DoxyCompactList}\small\item\em This function is executed in case of error occurrence. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_a62fcafba91cf315db7e0e0c8f22c656f}\label{main_8c_a62fcafba91cf315db7e0e0c8f22c656f} 
ADC\+\_\+\+Handle\+Type\+Def {\bfseries hadc}
\item 
\Hypertarget{main_8c_a556a7c43d0d5bbeccebc55d3f97e0fd5}\label{main_8c_a556a7c43d0d5bbeccebc55d3f97e0fd5} 
DMA\+\_\+\+Handle\+Type\+Def {\bfseries hdma\+\_\+adc}
\item 
\Hypertarget{main_8c_af7b2c26e44dadaaa798a5c3d82914ba7}\label{main_8c_af7b2c26e44dadaaa798a5c3d82914ba7} 
I2\+C\+\_\+\+Handle\+Type\+Def {\bfseries hi2c1}
\item 
\Hypertarget{main_8c_a2c80fd5510e2990a59a5c90d745c716c}\label{main_8c_a2c80fd5510e2990a59a5c90d745c716c} 
TIM\+\_\+\+Handle\+Type\+Def {\bfseries htim2}
\item 
\Hypertarget{main_8c_aac3d2c59ee0e3bbae1b99529a154eb62}\label{main_8c_aac3d2c59ee0e3bbae1b99529a154eb62} 
TIM\+\_\+\+Handle\+Type\+Def {\bfseries htim3}
\item 
\Hypertarget{main_8c_aece2b6102e71af538bcdcb5cace3281c}\label{main_8c_aece2b6102e71af538bcdcb5cace3281c} 
TIM\+\_\+\+Handle\+Type\+Def {\bfseries htim21}
\item 
\Hypertarget{main_8c_aa9479c261d65eecedd3d9582f7f0f89c}\label{main_8c_aa9479c261d65eecedd3d9582f7f0f89c} 
UART\+\_\+\+Handle\+Type\+Def {\bfseries huart2}
\item 
\mbox{\hyperlink{structmotor__struct}{motor\+\_\+struct}} \mbox{\hyperlink{main_8c_a69bb3ebce970cee15d53f8113dd2820c}{motor\+\_\+instance}}
\item 
volatile int \mbox{\hyperlink{main_8c_a53a8da0047dd232ae15f3669cc711577}{flag\+\_\+turn\+\_\+on\+\_\+off}} = 0
\item 
volatile int \mbox{\hyperlink{main_8c_abb9049988b57e39edbcb4ee27be7c736}{flag\+\_\+send\+\_\+data}} = 0
\item 
volatile int \mbox{\hyperlink{main_8c_ad7160d92669c41769affe3296de3b6a0}{flag\+\_\+refresh\+\_\+\+LCD}} = 0
\item 
char \mbox{\hyperlink{main_8c_a86154b8a8c2bf0bde8e74703c8202981}{uart\+\_\+buffer}} \mbox{[}100\mbox{]}
\item 
int \mbox{\hyperlink{main_8c_a4c4b7038b89e39874ddd1278634b34cb}{lcd\+\_\+refresh\+\_\+counter}} = 0
\item 
int \mbox{\hyperlink{main_8c_a8a8bc56ceb0e856c21c1752807878bd5}{new\+\_\+speed}} = 0
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{main_8c_a8f11bfbdcd9e3fd90cb25c23462131eb}{last\+\_\+\+EXTI\+\_\+interrupt\+\_\+time}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Plik nagłówkowy do sterowania silnikiem DC z wykorzystaniem algorytmu PID. 

Plik główny projektu regulacego prędkości obrotowej silnika DC, dostosowaną do zmieniającego się obciążenia. Algorytm PID zapewnia precyzyjną kontrolę prędkości i stabilność pracy silnika w różnych warunkach.

Program obsługuje sterowanie silnikiem oraz przetwarzanie danych z ADC przy użyciu DMA. Timer generuje przerwanie co 100 ms, w którym realizowane są operacje sterujące silnikiem oraz ustawiane flagi do dalszej komunikacji (UART oraz LCD). Pętla główna odpowiedzialna jest za kontrolowanie tych flag i warunkowe obsłużenie UART oraz LCD. Nadrzędna flaga pochodząca od przycisku warunkuje wykonywanie całego programu (nie blokuje kontrolera)

Kluczowe funkcje\+:
\begin{DoxyEnumerate}
\item {\bfseries{Timer Interrupt (100 ms)}} -\/ uaktualnienie odczytu z DMA, sterowanie silnikiem oraz wystawianie flagi do komunikacji.
\item {\bfseries{ADC w trybie DMA}} -\/ pobieranie danych z czujników w sposób bezpośredni, bez angażowania procesora, co pozwala na asynchroniczne zbieranie próbek.
\item {\bfseries{Pętla główna}} -\/ analizowanie flagi z przerwania, obsługa komunikacji.
\item {\bfseries{EXTI Interrupt}} -\/ przerwanie działania programu, wyłączenie silnika

Created on\+: Dec 1, 2024 Author\+: Igor 
\end{DoxyEnumerate}

\doxysubsection{Function Documentation}
\Hypertarget{main_8c_a1730ffe1e560465665eb47d9264826f9}\index{main.c@{main.c}!Error\_Handler@{Error\_Handler}}
\index{Error\_Handler@{Error\_Handler}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{Error\_Handler()}{Error\_Handler()}}
{\footnotesize\ttfamily \label{main_8c_a1730ffe1e560465665eb47d9264826f9} 
void Error\+\_\+\+Handler (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



This function is executed in case of error occurrence. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a1730ffe1e560465665eb47d9264826f9_icgraph}
\end{center}
\end{figure}
\Hypertarget{main_8c_a0cd91fd3a9608559c2a87a8ba6cba55f}\index{main.c@{main.c}!HAL\_GPIO\_EXTI\_Callback@{HAL\_GPIO\_EXTI\_Callback}}
\index{HAL\_GPIO\_EXTI\_Callback@{HAL\_GPIO\_EXTI\_Callback}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{HAL\_GPIO\_EXTI\_Callback()}{HAL\_GPIO\_EXTI\_Callback()}}
{\footnotesize\ttfamily \label{main_8c_a0cd91fd3a9608559c2a87a8ba6cba55f} 
void HAL\+\_\+\+GPIO\+\_\+\+EXTI\+\_\+\+Callback (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{GPIO\+\_\+\+Pin}{}\end{DoxyParamCaption})}



Callback do obsługi przerwania zewnętrznego (przycisk). 

Funkcja ta jest wywoływana po naciśnięciu przycisku (GPIO\+\_\+\+Pin == B1\+\_\+\+Pin). Wykonuje debouncing oraz w zależności od stanu flagi włącza lub wyłącza silnik, a także zarządza podświetleniem wyświetlacza LCD.


\begin{DoxyParams}{Parameters}
{\em GPIO\+\_\+\+Pin} & Numer pinu, który wywołał przerwanie. \\
\hline
\end{DoxyParams}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a0cd91fd3a9608559c2a87a8ba6cba55f_cgraph}
\end{center}
\end{figure}
\Hypertarget{main_8c_a8a3b0ad512a6e6c6157440b68d395eac}\index{main.c@{main.c}!HAL\_TIM\_PeriodElapsedCallback@{HAL\_TIM\_PeriodElapsedCallback}}
\index{HAL\_TIM\_PeriodElapsedCallback@{HAL\_TIM\_PeriodElapsedCallback}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{HAL\_TIM\_PeriodElapsedCallback()}{HAL\_TIM\_PeriodElapsedCallback()}}
{\footnotesize\ttfamily \label{main_8c_a8a3b0ad512a6e6c6157440b68d395eac} 
void HAL\+\_\+\+TIM\+\_\+\+Period\+Elapsed\+Callback (\begin{DoxyParamCaption}\item[{TIM\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*}}]{htim}{}\end{DoxyParamCaption})}



Callback do obsługi przerwania timera. 

Ta funkcja jest wywoływana, gdy upłynie okres timer\textquotesingle{}a htim21. Aktualizuje odczyt ADC, oblicza prędkość silnika, przygotowuje dane do wysłania przez UART oraz zarządza flagami wysłania danych i odświeżania wyświetlacza LCD. Przygotowanie danych do wysyłki w tym miejscu gwarantuje, że dane wysłane przez UART i wyświetlone na ekranie pochodzą z tego samego punktu czasowego.


\begin{DoxyParams}{Parameters}
{\em htim} & Pointer do struktury TIM\+\_\+\+Handle\+Type\+Def zawierającej informacje o timerze. \\
\hline
\end{DoxyParams}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a8a3b0ad512a6e6c6157440b68d395eac_cgraph}
\end{center}
\end{figure}
\Hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily \label{main_8c_a840291bc02cba5474a4cb46a9b9566fe} 
int main (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Główna funkcja programu, zawiera inicjalizację peryferiów oraz obsługę wystawionych flag. 

Funkcja inicjalizuje wszystkie peryferia, w tym ADC, PWM, enkoder, UART i LCD. Następnie w pętli głównej programu monitoruje flagi i warunkowo wysyła dane przez UART oraz aktualizuje stan ekranu LCD


\begin{DoxyRetVals}{Return values}
{\em int} & Zwraca 0 w przypadku poprawnego zakończenia. \\
\hline
\end{DoxyRetVals}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a840291bc02cba5474a4cb46a9b9566fe_cgraph}
\end{center}
\end{figure}
\Hypertarget{main_8c_a70af21c671abfcc773614a9a4f63d920}\index{main.c@{main.c}!SystemClock\_Config@{SystemClock\_Config}}
\index{SystemClock\_Config@{SystemClock\_Config}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{SystemClock\_Config()}{SystemClock\_Config()}}
{\footnotesize\ttfamily \label{main_8c_a70af21c671abfcc773614a9a4f63d920} 
void System\+Clock\+\_\+\+Config (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



System Clock Configuration. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
Configure the main internal regulator output voltage

Initializes the RCC Oscillators according to the specified parameters in the RCC\+\_\+\+Osc\+Init\+Type\+Def structure.

Initializes the CPU, AHB and APB buses clocksHere is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=301pt]{main_8c_a70af21c671abfcc773614a9a4f63d920_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=262pt]{main_8c_a70af21c671abfcc773614a9a4f63d920_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\Hypertarget{main_8c_ad7160d92669c41769affe3296de3b6a0}\index{main.c@{main.c}!flag\_refresh\_LCD@{flag\_refresh\_LCD}}
\index{flag\_refresh\_LCD@{flag\_refresh\_LCD}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{flag\_refresh\_LCD}{flag\_refresh\_LCD}}
{\footnotesize\ttfamily \label{main_8c_ad7160d92669c41769affe3296de3b6a0} 
volatile int flag\+\_\+refresh\+\_\+\+LCD = 0}

Flaga do odświeżania wyświetlacza LCD \Hypertarget{main_8c_abb9049988b57e39edbcb4ee27be7c736}\index{main.c@{main.c}!flag\_send\_data@{flag\_send\_data}}
\index{flag\_send\_data@{flag\_send\_data}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{flag\_send\_data}{flag\_send\_data}}
{\footnotesize\ttfamily \label{main_8c_abb9049988b57e39edbcb4ee27be7c736} 
volatile int flag\+\_\+send\+\_\+data = 0}

Flaga wskazująca na konieczność wysłania danych przez UART \Hypertarget{main_8c_a53a8da0047dd232ae15f3669cc711577}\index{main.c@{main.c}!flag\_turn\_on\_off@{flag\_turn\_on\_off}}
\index{flag\_turn\_on\_off@{flag\_turn\_on\_off}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{flag\_turn\_on\_off}{flag\_turn\_on\_off}}
{\footnotesize\ttfamily \label{main_8c_a53a8da0047dd232ae15f3669cc711577} 
volatile int flag\+\_\+turn\+\_\+on\+\_\+off = 0}

Flaga do włączania/wyłączania silnika \Hypertarget{main_8c_a8f11bfbdcd9e3fd90cb25c23462131eb}\index{main.c@{main.c}!last\_EXTI\_interrupt\_time@{last\_EXTI\_interrupt\_time}}
\index{last\_EXTI\_interrupt\_time@{last\_EXTI\_interrupt\_time}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{last\_EXTI\_interrupt\_time}{last\_EXTI\_interrupt\_time}}
{\footnotesize\ttfamily \label{main_8c_a8f11bfbdcd9e3fd90cb25c23462131eb} 
volatile uint32\+\_\+t last\+\_\+\+EXTI\+\_\+interrupt\+\_\+time}

Zmienna do cyfrowego debouncingu przycisku \Hypertarget{main_8c_a4c4b7038b89e39874ddd1278634b34cb}\index{main.c@{main.c}!lcd\_refresh\_counter@{lcd\_refresh\_counter}}
\index{lcd\_refresh\_counter@{lcd\_refresh\_counter}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{lcd\_refresh\_counter}{lcd\_refresh\_counter}}
{\footnotesize\ttfamily \label{main_8c_a4c4b7038b89e39874ddd1278634b34cb} 
int lcd\+\_\+refresh\+\_\+counter = 0}

Licznik odświeżania wyświetlacza LCD \Hypertarget{main_8c_a69bb3ebce970cee15d53f8113dd2820c}\index{main.c@{main.c}!motor\_instance@{motor\_instance}}
\index{motor\_instance@{motor\_instance}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{motor\_instance}{motor\_instance}}
{\footnotesize\ttfamily \label{main_8c_a69bb3ebce970cee15d53f8113dd2820c} 
\mbox{\hyperlink{structmotor__struct}{motor\+\_\+struct}} motor\+\_\+instance}

Instancja silnika DC \Hypertarget{main_8c_a8a8bc56ceb0e856c21c1752807878bd5}\index{main.c@{main.c}!new\_speed@{new\_speed}}
\index{new\_speed@{new\_speed}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{new\_speed}{new\_speed}}
{\footnotesize\ttfamily \label{main_8c_a8a8bc56ceb0e856c21c1752807878bd5} 
int new\+\_\+speed = 0}

Obliczona prędkość silnika na podstawie odczytu z ADC. \Hypertarget{main_8c_a86154b8a8c2bf0bde8e74703c8202981}\index{main.c@{main.c}!uart\_buffer@{uart\_buffer}}
\index{uart\_buffer@{uart\_buffer}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{uart\_buffer}{uart\_buffer}}
{\footnotesize\ttfamily \label{main_8c_a86154b8a8c2bf0bde8e74703c8202981} 
char uart\+\_\+buffer\mbox{[}100\mbox{]}}

Bufor do komunikacji UART 